{% extends "base.html" %}
{% block title %}Project Review - LaunchForge{% endblock %}
{% block content %}
<style>
    .review-container { max-width: 900px; margin: 0 auto; }
    .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }
    .status-analyzing { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .status-ready { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .idea-box { background: var(--nexus-card); border: 1px solid var(--nexus-border); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
    .analysis-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 24px; }
    .analysis-card { background: var(--nexus-card); border: 1px solid var(--nexus-border); border-radius: 12px; padding: 20px; }
    .analysis-card h3 { font-size: 0.9rem; color: var(--nexus-text); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .analysis-card .value { font-size: 1.5rem; font-weight: 600; color: white; }
    .analysis-card .detail { font-size: 0.9rem; color: var(--nexus-text); margin-top: 8px; }
    .features-list { list-style: none; padding: 0; }
    .features-list li { display: flex; align-items: center; gap: 10px; padding: 12px 0; border-bottom: 1px solid var(--nexus-border); }
    .features-list li:last-child { border-bottom: none; }
    .feature-check { width: 20px; height: 20px; background: var(--nexus-purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
    .action-buttons { display: flex; gap: 16px; margin-top: 32px; }
    .btn-primary { flex: 1; padding: 16px 24px; background: var(--nexus-purple); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; }
    .btn-secondary { flex: 1; padding: 16px 24px; background: transparent; color: white; border: 1px solid var(--nexus-border); border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; }
    .loading-pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
</style>

<div class="review-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h1 style="font-size: 2rem; font-weight: 700;">Project Review</h1>
        <span class="status-badge status-{{ project.status }}" id="statusBadge">
            <span class="loading-pulse">‚óè</span> {{ project.status|title }}
        </span>
    </div>

    <div class="idea-box">
        <h2 style="font-size: 1rem; color: var(--nexus-text); margin-bottom: 12px;">Your Idea</h2>
        <p style="font-size: 1.1rem; line-height: 1.6;">{{ project.idea }}</p>
    </div>

    <h2 style="font-size: 1.25rem; margin-bottom: 16px;">Market Analysis</h2>
    <div class="analysis-grid">
        <div class="analysis-card">
            <h3>Market Size</h3>
            <div class="value" id="marketSize">{{ project.analysis.market_size }}</div>
            <div class="detail">Total addressable market</div>
        </div>
        <div class="analysis-card">
            <h3>Competition Level</h3>
            <div class="value" id="competition">{{ project.analysis.competition }}</div>
            <div class="detail">Based on existing solutions</div>
        </div>
        <div class="analysis-card">
            <h3>Feasibility Score</h3>
            <div class="value" id="feasibility">{{ project.analysis.feasibility }}</div>
            <div class="detail">Technical implementation</div>
        </div>
        <div class="analysis-card">
            <h3>Time to Market</h3>
            <div class="value" id="timeToMarket">{{ project.analysis.time_to_market|default('2-4 weeks') }}</div>
            <div class="detail">Estimated with our platform</div>
        </div>
    </div>

    <h2 style="font-size: 1.25rem; margin-bottom: 16px;">Recommended Features</h2>
    <div class="card" style="padding: 20px; margin-bottom: 24px;">
        <ul class="features-list" id="featuresList">
            {% for feature in project.analysis.recommended_features %}
            <li>
                <span class="feature-check">‚úì</span>
                <span>{{ feature }}</span>
            </li>
            {% else %}
            <li class="loading-pulse">Analyzing recommended features...</li>
            {% endfor %}
        </ul>
    </div>

    <div class="action-buttons">
        <button class="btn-secondary" onclick="window.location.href='/dashboard'">Back to Dashboard</button>
        <button class="btn-primary" id="generateBtn" {% if project.status == 'analyzing' %}disabled{% endif %}>
            üöÄ Generate My App
        </button>
    </div>
</div>

<script>
// Handle generate button click
document.getElementById('generateBtn').addEventListener('click', async function() {
    const btn = this;
    btn.disabled = true;
    btn.innerHTML = '‚è≥ Generating...';
    
    try {
        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ project_id: '{{ project.id }}' })
        });
        const data = await response.json();
        
        if (data.success) {
            btn.innerHTML = '‚úÖ Generated!';
            // Show download section
            setTimeout(() => {
                window.location.href = '/projects/{{ project.id }}/generated';
            }, 1000);
        } else {
            btn.innerHTML = '‚ùå Error: ' + data.error;
            btn.disabled = false;
        }
    } catch (error) {
        btn.innerHTML = '‚ùå Error';
        btn.disabled = false;
    }
});

// Poll for updates if still analyzing
{% if project.status == 'analyzing' %}
setInterval(async () => {
    const response = await fetch('/api/projects/{{ project.id }}');
    const data = await response.json();
    if (data.status === 'ready') {
        location.reload();
    }
}, 3000);
{% endif %}
</script>
{% endblock %}
