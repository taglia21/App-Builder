{% extends "base.html" %}

{% block title %}{{ project.name }} - Valeric{% endblock %}

{% block extra_css %}
<style>
    .detail-card {
        background: var(--nexus-card);
        border: 1px solid var(--nexus-border);
        border-radius: 12px;
        padding: 24px;
    }
    .detail-input {
        width: 100%;
        background: var(--nexus-dark);
        border: 1px solid var(--nexus-border);
        border-radius: 8px;
        padding: 10px 14px;
        color: white;
        font-size: 0.875rem;
        outline: none;
    }
    .detail-input:focus {
        border-color: var(--nexus-purple);
    }
</style>
{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header -->
    <div class="lg:flex lg:items-center lg:justify-between">
        <div class="min-w-0 flex-1">
            <nav class="flex" aria-label="Breadcrumb">
                <ol role="list" class="flex items-center space-x-4">
                    <li>
                        <a href="/dashboard" class="text-sm font-medium text-gray-500 hover:text-gray-700">Dashboard</a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="h-5 w-5 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                            <span class="ml-4 text-sm font-medium text-gray-500">{{ project.name }}</span>
                        </div>
                    </li>
                </ol>
            </nav>
            <h1 class="mt-2 text-2xl font-bold leading-7 text-white sm:truncate sm:text-3xl">{{ project.name }}</h1>
            <div class="mt-1 flex flex-col sm:mt-0 sm:flex-row sm:flex-wrap sm:space-x-6">
                <div class="mt-2 flex items-center text-sm text-gray-500">
                    {% if project.status == 'deployed' %}
                    <span class="inline-flex items-center rounded-md bg-green-900/30 px-2 py-1 text-xs font-medium text-green-400 ring-1 ring-inset ring-green-500/30">
                        <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 8 8">
                            <circle cx="4" cy="4" r="3" />
                        </svg>
                        Deployed
                    </span>
                    {% elif project.status == 'generating' %}
                    <span class="inline-flex items-center rounded-md bg-yellow-900/30 px-2 py-1 text-xs font-medium text-yellow-400 ring-1 ring-inset ring-yellow-500/30">
                        <svg class="animate-spin mr-1 h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Generating
                    </span>
                    {% elif project.status == 'deploying' %}
                    <span class="inline-flex items-center rounded-md bg-blue-900/30 px-2 py-1 text-xs font-medium text-blue-400 ring-1 ring-inset ring-blue-500/30">
                        <svg class="animate-spin mr-1 h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Deploying
                    </span>
                    {% elif project.status == 'failed' %}
                    <span class="inline-flex items-center rounded-md bg-red-900/30 px-2 py-1 text-xs font-medium text-red-400 ring-1 ring-inset ring-red-500/30">
                        <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 8 8">
                            <circle cx="4" cy="4" r="3" />
                        </svg>
                        Failed
                    </span>
                    {% else %}
                    <span class="inline-flex items-center rounded-md bg-gray-800 px-2 py-1 text-xs font-medium text-gray-300 ring-1 ring-inset ring-gray-600/30">
                        Draft
                    </span>
                    {% endif %}
                </div>
                <div class="mt-2 flex items-center text-sm text-gray-500">
                    <svg class="mr-1.5 h-5 w-5 flex-shrink-0 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
                    </svg>
                    Created {{ project.created_at if project.created_at else 'recently' }}
                </div>
            </div>
        </div>
        <div class="mt-5 flex lg:ml-4 lg:mt-0 space-x-3">
            {% if project.status == 'draft' or project.status == 'ready' %}
            <button type="button" 
                    hx-post="/api/deploy"
                    hx-vals='{"project_id": "{{ project.id }}"}'
                    hx-swap="none"
                    class="inline-flex items-center rounded-md bg-forge-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-forge-500">
                <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z" clip-rule="evenodd" />
                </svg>
                Deploy
            </button>
            {% endif %}
            
            {% if project.urls and project.urls.frontend %}
            <a href="{{ project.urls.frontend }}" 
               target="_blank"
               class="inline-flex items-center rounded-md bg-gray-800 px-3 py-2 text-sm font-semibold text-gray-200 shadow-sm ring-1 ring-inset ring-gray-600 hover:bg-gray-700">
                <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M6.194 12.753a.75.75 0 001.06.053L16.5 4.44v2.81a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5a.75.75 0 000 1.5h2.553l-9.056 8.194a.75.75 0 00-.053 1.06z" clip-rule="evenodd" />
                </svg>
                View App
            </a>
            {% endif %}
            
            {% if project.urls and project.urls.github %}
            <a href="{{ project.urls.github }}" 
               target="_blank"
               class="inline-flex items-center rounded-md bg-gray-800 px-3 py-2 text-sm font-semibold text-gray-200 shadow-sm ring-1 ring-inset ring-gray-600 hover:bg-gray-700">
                <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
                </svg>
                GitHub
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Tabs -->
    <div class="mt-8 border-b border-gray-700">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs" id="project-tabs">
            <a href="#overview" data-tab="overview" class="tab-link border-forge-500 text-forge-600 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                Overview
            </a>
            <a href="#code" data-tab="code" class="tab-link border-transparent text-gray-500 hover:border-gray-500 hover:text-gray-300 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                Code
            </a>
            <a href="#deployments" data-tab="deployments" class="tab-link border-transparent text-gray-500 hover:border-gray-500 hover:text-gray-300 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                Deployments
            </a>
            <a href="#settings" data-tab="settings" class="tab-link border-transparent text-gray-500 hover:border-gray-500 hover:text-gray-300 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                Settings
            </a>
        </nav>
    </div>
    
    <!-- Tab Content: Overview -->
    <div id="overview" class="tab-content mt-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Description -->
            <div class="detail-card">
                <h2 class="text-lg font-medium text-white">Description</h2>
                <p class="mt-2 text-sm text-gray-400">{{ project.description }}</p>
            </div>
            
            <!-- Generation Progress (if generating) -->
            {% if project.status == 'generating' %}
            <div id="generation-status"
                 hx-get="/htmx/projects/{{ project.id }}/progress"
                 hx-trigger="every 2s"
                 hx-swap="innerHTML"
                 class="detail-card">
                <h2 class="text-lg font-medium text-white">Generation Progress</h2>
                <div class="mt-4">
                    <div class="relative pt-1">
                        <div class="flex mb-2 items-center justify-between">
                            <div>
                                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-forge-600 bg-forge-200">
                                    Generating...
                                </span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-semibold inline-block text-forge-600">0%</span>
                            </div>
                        </div>
                        <div class="overflow-hidden h-2 text-xs flex rounded bg-forge-200">
                            <div class="animate-progress shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-forge-500"></div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Deployment Status -->
            <div id="deployment-status" class="detail-card">
                <h2 class="text-lg font-medium text-white mb-4">Deployment</h2>
                <div id="deploy-overview-content">
                    {% if project.status == 'deployed' and project.urls %}
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                        <div style="padding:14px; background:var(--nexus-dark,#0a0a0b); border:1px solid var(--nexus-border,#27272a); border-radius:8px;">
                            <div style="font-size:0.75rem; color:#6b7280; text-transform:uppercase; font-weight:600; margin-bottom:4px;">Status</div>
                            <div style="display:flex; align-items:center; gap:6px;">
                                <span style="width:8px;height:8px;border-radius:50%;background:#22c55e;display:inline-block;"></span>
                                <span style="color:#22c55e; font-weight:600;">Active</span>
                            </div>
                        </div>
                        <div style="padding:14px; background:var(--nexus-dark,#0a0a0b); border:1px solid var(--nexus-border,#27272a); border-radius:8px;">
                            <div style="font-size:0.75rem; color:#6b7280; text-transform:uppercase; font-weight:600; margin-bottom:4px;">Environment</div>
                            <span style="color:white; font-weight:600;">Production</span>
                        </div>
                        {% if project.deployed_at %}
                        <div style="padding:14px; background:var(--nexus-dark,#0a0a0b); border:1px solid var(--nexus-border,#27272a); border-radius:8px;">
                            <div style="font-size:0.75rem; color:#6b7280; text-transform:uppercase; font-weight:600; margin-bottom:4px;">Last Deployed</div>
                            <span style="color:white;">{{ project.deployed_at }}</span>
                        </div>
                        {% endif %}
                        {% if project.urls.frontend %}
                        <div style="padding:14px; background:var(--nexus-dark,#0a0a0b); border:1px solid var(--nexus-border,#27272a); border-radius:8px;">
                            <div style="font-size:0.75rem; color:#6b7280; text-transform:uppercase; font-weight:600; margin-bottom:4px;">URL</div>
                            <a href="{{ project.urls.frontend }}" target="_blank" style="color:#a78bfa; font-size:0.875rem;">{{ project.urls.frontend }}</a>
                        </div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div style="text-align:center; padding:24px; color:#6b7280; font-size:0.875rem;">
                        <svg style="width:32px;height:32px;margin:0 auto 8px;opacity:0.5;" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z"/></svg>
                        <p>Not yet deployed</p>
                        <p style="font-size:0.75rem; margin-top:4px;">Deploy your project to see status here</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Tech Stack -->
            {% if project.tech_stack %}
            <div class="detail-card">
                <h2 class="text-lg font-medium text-white">Tech Stack</h2>
                <dl class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {% for tech in project.tech_stack %}
                    <div class="border border-gray-700 rounded-lg p-3">
                        <dt class="text-xs font-medium text-gray-500 uppercase">{{ tech }}</dt>
                        <dd class="mt-1 text-sm font-semibold text-white">{{ tech }}</dd>
                    </div>
                    {% endfor %}
                </dl>
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- URLs -->
            {% if project.urls %}
            <div class="detail-card">
                <h2 class="text-lg font-medium text-white">Links</h2>
                <ul class="mt-4 space-y-3">
                    {% if project.urls.frontend %}
                    <li class="flex items-center">
                        <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-green-900/30 text-green-400">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        <a href="{{ project.urls.frontend }}" target="_blank" class="ml-3 text-sm text-forge-600 hover:underline truncate">
                            {{ project.urls.frontend }}
                        </a>
                    </li>
                    {% endif %}
                    {% if project.urls.backend %}
                    <li class="flex items-center">
                        <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-blue-900/30 text-blue-400">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4.632 3.533A2 2 0 016.577 2h6.846a2 2 0 011.945 1.533l1.976 8.234A3.489 3.489 0 0016 11.5H4c-.476 0-.93.095-1.344.267l1.976-8.234z" />
                                <path fill-rule="evenodd" d="M4 13a2 2 0 100 4h12a2 2 0 100-4H4zm11.24 2a.75.75 0 01.75-.75H16a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75h-.01a.75.75 0 01-.75-.75V15zm-2.25-.75a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75H13a.75.75 0 00.75-.75V15a.75.75 0 00-.75-.75h-.01z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        <a href="{{ project.urls.backend }}" target="_blank" class="ml-3 text-sm text-forge-600 hover:underline truncate">
                            {{ project.urls.backend }}
                        </a>
                    </li>
                    {% endif %}
                    {% if project.urls.github %}
                    <li class="flex items-center">
                        <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-gray-800 text-gray-400">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        <a href="{{ project.urls.github }}" target="_blank" class="ml-3 text-sm text-forge-600 hover:underline truncate">
                            {{ project.urls.github }}
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Features -->
            {% if project.features %}
            <div class="detail-card">
                <h2 class="text-lg font-medium text-white">Features</h2>
                <ul class="mt-4 space-y-2">
                    {% for feature in project.features %}
                    <li class="flex items-center text-sm text-gray-400">
                        <svg class="mr-2 h-4 w-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                        </svg>
                        {{ feature }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Quick Actions -->
            <div class="detail-card">
                <h2 class="text-lg font-medium text-white">Actions</h2>
                <div class="mt-4 space-y-3">
                    <button type="button" 
                            hx-post="/api/generate"
                            hx-vals='{"project_id": "{{ project.id }}", "regenerate": true}'
                            class="w-full inline-flex justify-center items-center rounded-md bg-gray-800 px-3 py-2 text-sm font-semibold text-gray-200 shadow-sm ring-1 ring-inset ring-gray-600 hover:bg-gray-700">
                        <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>
                        Regenerate Code
                    </button>
                    <button type="button" 
                            onclick="confirm('Are you sure you want to delete this project?') && document.getElementById('delete-form').submit()"
                            class="w-full inline-flex justify-center items-center rounded-md bg-red-900/30 px-3 py-2 text-sm font-semibold text-red-400 shadow-sm ring-1 ring-inset ring-red-500/30 hover:bg-red-900/50">
                        <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                        Delete Project
                    </button>
                </div>
                <form id="delete-form" action="/api/projects/{{ project.id }}" method="DELETE" class="hidden"></form>
            </div>
        </div>
    </div>
    </div><!-- end #overview -->

    <!-- Tab Content: Code -->
    <div id="code" class="tab-content mt-8 hidden">
    <div class="grid grid-cols-1 gap-6">
        <!-- Generated Files -->
        <div class="detail-card">
            <h2 class="text-lg font-medium text-white mb-4">Generated Files</h2>
            {% if project.output_path %}
            <div id="code-files"
                 hx-get="/htmx/projects/{{ project.id }}/files"
                 hx-trigger="revealed"
                 hx-swap="innerHTML">
                <div class="border border-gray-700 rounded-lg divide-y divide-gray-700">
                    <div class="p-4 text-sm text-gray-400 flex items-center">
                        <svg class="animate-spin mr-2 h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Loading files...
                    </div>
                </div>
            </div>
            {% else %}
            <p class="text-sm text-gray-500">No code has been generated yet. Generate your project first to view the code.</p>
            {% endif %}
        </div>

        <!-- Download Code -->
        {% if project.output_path %}
        <div class="detail-card">
            <h2 class="text-lg font-medium text-white mb-4">Download</h2>
            <a href="/api/projects/{{ project.id }}/download"
               class="inline-flex items-center rounded-md bg-forge-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-forge-500">
                <svg class="-ml-0.5 mr-1.5 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                </svg>
                Download Source Code
            </a>
        </div>
        {% endif %}
    </div>
    </div><!-- end #code -->

    <!-- Tab Content: Deployments -->
    <div id="deployments" class="tab-content mt-8 hidden">
    <div class="grid grid-cols-1 gap-6">
        <!-- Deployment Status -->
        <div class="detail-card">
            <h2 class="text-lg font-medium text-white mb-4">Deployment Status</h2>
            <div id="deployment-detail-content">
                {% if project.status == 'deployed' and project.urls %}
                <div style="padding:16px; background:var(--nexus-dark,#0a0a0b); border:1px solid var(--nexus-border,#27272a); border-radius:8px;">
                    <div style="display:grid; grid-template-columns:120px 1fr; gap:8px; font-size:0.875rem;">
                        {% if project.urls.frontend %}
                        <span style="color:#6b7280;">URL</span><a href="{{ project.urls.frontend }}" target="_blank" style="color:#a78bfa;">{{ project.urls.frontend }}</a>
                        {% endif %}
                        {% if project.urls.github %}
                        <span style="color:#6b7280;">Repository</span><a href="{{ project.urls.github }}" target="_blank" style="color:#a78bfa;">{{ project.urls.github }}</a>
                        {% endif %}
                        <span style="color:#6b7280;">Status</span><span style="color:#22c55e;">Deployed</span>
                    </div>
                </div>
                {% else %}
                <div style="text-align:center; padding:24px; color:#6b7280; font-size:0.875rem;">
                    <p>No deployment data available</p>
                    <p style="font-size:0.75rem; margin-top:4px;">Deploy your project to see details here</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Deployment History -->
        <div class="detail-card">
            <h2 class="text-lg font-medium text-white mb-4">Deployment History</h2>
            <div id="deployment-history-content">
                <div style="text-align:center; padding:24px; color:#6b7280; font-size:0.875rem;">
                    <p>No deployment history yet</p>
                </div>
            </div>
        </div>

        <!-- Deploy Actions -->
        <div class="detail-card">
            <h2 class="text-lg font-medium text-white mb-4">Actions</h2>
            <div class="flex space-x-3">
                {% if project.status == 'draft' or project.status == 'ready' or project.status == 'deployed' %}
                <button type="button"
                        hx-post="/api/deploy"
                        hx-vals='{"project_id": "{{ project.id }}"}'
                        hx-swap="none"
                        class="inline-flex items-center rounded-md bg-forge-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-forge-500">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z" clip-rule="evenodd" />
                    </svg>
                    {% if project.status == 'deployed' %}Redeploy{% else %}Deploy{% endif %}
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    </div><!-- end #deployments -->

    <!-- Tab Content: Settings -->
    <div id="settings" class="tab-content mt-8 hidden">
    <div class="grid grid-cols-1 gap-6">
        <!-- Project Settings -->
        <div class="detail-card">
            <h2 class="text-lg font-medium text-white mb-4">Project Settings</h2>
            <form hx-put="/api/projects/{{ project.id }}" hx-swap="none" class="space-y-4">
                <div>
                    <label for="project-name" class="block text-sm font-medium text-gray-300">Project Name</label>
                    <input type="text" id="project-name" name="name" value="{{ project.name }}"
                           class="detail-input mt-1">
                </div>
                <div>
                    <label for="project-description" class="block text-sm font-medium text-gray-300">Description</label>
                    <textarea id="project-description" name="description" rows="3"
                              class="detail-input mt-1">{{ project.description }}</textarea>
                </div>
                <div class="flex justify-end">
                    <button type="submit"
                            class="inline-flex items-center rounded-md bg-forge-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-forge-500">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>

        <!-- Danger Zone -->
        <div class="detail-card" style="border-color: rgba(239,68,68,0.3);">
            <h2 class="text-lg font-medium text-red-400 mb-4">Danger Zone</h2>
            <p class="text-sm text-gray-400 mb-4">Once you delete a project, there is no going back. Please be certain.</p>
            <button type="button"
                    onclick="confirm('Are you sure you want to delete this project? This action cannot be undone.') && document.getElementById('delete-form-settings').submit()"
                    class="inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500">
                <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                </svg>
                Delete This Project
            </button>
            <form id="delete-form-settings" action="/api/projects/{{ project.id }}" method="DELETE" class="hidden"></form>
        </div>
    </div>
    </div><!-- end #settings -->

</div>

<!-- Tab Switching JavaScript -->
<script>
(function() {
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');
    const ACTIVE_CLASSES = ['border-forge-500', 'text-forge-600'];
    const INACTIVE_CLASSES = ['border-transparent', 'text-gray-500', 'hover:border-gray-500', 'hover:text-gray-300'];

    function switchTab(tabName) {
        // Hide all tab contents
        tabContents.forEach(function(content) {
            content.classList.add('hidden');
        });

        // Deactivate all tab links
        tabLinks.forEach(function(link) {
            ACTIVE_CLASSES.forEach(function(cls) { link.classList.remove(cls); });
            INACTIVE_CLASSES.forEach(function(cls) { link.classList.add(cls); });
        });

        // Show target tab content
        var target = document.getElementById(tabName);
        if (target) {
            target.classList.remove('hidden');
        }

        // Activate the clicked tab link
        var activeLink = document.querySelector('.tab-link[data-tab="' + tabName + '"]');
        if (activeLink) {
            INACTIVE_CLASSES.forEach(function(cls) { activeLink.classList.remove(cls); });
            ACTIVE_CLASSES.forEach(function(cls) { activeLink.classList.add(cls); });
        }

        // Process any htmx attributes on newly revealed content
        if (target && typeof htmx !== 'undefined') {
            htmx.process(target);
        }
    }

    // Attach click handlers
    tabLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            var tabName = this.getAttribute('data-tab');
            switchTab(tabName);
            history.replaceState(null, '', '#' + tabName);
        });
    });

    // Handle initial hash or default to overview
    var hash = window.location.hash.replace('#', '');
    if (hash && document.getElementById(hash)) {
        switchTab(hash);
    } else {
        switchTab('overview');
    }
})();
</script>
{% endblock %}
