{% extends "base.html" %}

{% block title %}Deployment Health - LaunchForge{% endblock %}

{% block content %}
<div class="py-8">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="md:flex md:items-center md:justify-between">
            <div class="min-w-0 flex-1">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                    Deployment Health Dashboard
                </h2>
                <p class="mt-1 text-sm text-gray-500">
                    Real-time monitoring of all your deployed applications
                </p>
            </div>
            <div class="mt-4 flex md:ml-4 md:mt-0">
                <button type="button" 
                        hx-get="/api/deployments/refresh" 
                        hx-target="#health-grid"
                        class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                    Refresh
                </button>
            </div>
        </div>

        <!-- Overall Status -->
        <div class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
            <!-- Total Deployments -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Deployments</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">{{ stats.total_deployments or 0 }}</dd>
            </div>
            
            <!-- Healthy -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Healthy</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-green-600">{{ stats.healthy or 0 }}</dd>
            </div>
            
            <!-- Degraded -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Degraded</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-yellow-600">{{ stats.degraded or 0 }}</dd>
            </div>
            
            <!-- Down -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Down</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-red-600">{{ stats.down or 0 }}</dd>
            </div>
        </div>

        <!-- Deployment Grid -->
        <div id="health-grid" class="mt-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {% for deployment in deployments %}
            <div class="overflow-hidden rounded-lg bg-white shadow">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            {% if deployment.status == 'healthy' %}
                            <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-green-100">
                                <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </span>
                            {% elif deployment.status == 'degraded' %}
                            <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-yellow-100">
                                <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                </svg>
                            </span>
                            {% else %}
                            <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-red-100">
                                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </span>
                            {% endif %}
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="truncate text-sm font-medium text-gray-500">{{ deployment.name }}</dt>
                                <dd class="flex items-baseline">
                                    <div class="text-lg font-semibold text-gray-900">{{ deployment.url }}</div>
                                </dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-5 py-3">
                    <div class="text-sm">
                        <div class="flex justify-between text-gray-500">
                            <span>Response Time</span>
                            <span class="font-medium {% if deployment.response_time < 200 %}text-green-600{% elif deployment.response_time < 500 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                {{ deployment.response_time or 0 }}ms
                            </span>
                        </div>
                        <div class="flex justify-between text-gray-500 mt-1">
                            <span>Uptime (30d)</span>
                            <span class="font-medium {% if deployment.uptime >= 99.9 %}text-green-600{% elif deployment.uptime >= 99 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                {{ deployment.uptime or 0 }}%
                            </span>
                        </div>
                        <div class="flex justify-between text-gray-500 mt-1">
                            <span>SSL</span>
                            <span class="font-medium {% if deployment.ssl_valid %}text-green-600{% else %}text-red-600{% endif %}">
                                {% if deployment.ssl_valid %}Valid ({{ deployment.ssl_days_remaining }}d){% else %}Invalid{% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-100 px-5 py-3 flex gap-2">
                    <a href="{{ deployment.url }}" target="_blank" class="text-xs text-forge-600 hover:text-forge-800">
                        Visit â†’
                    </a>
                    <a href="/projects/{{ deployment.project_id }}" class="text-xs text-gray-600 hover:text-gray-800">
                        Details
                    </a>
                    <button hx-post="/api/deployments/{{ deployment.id }}/restart" 
                            hx-swap="none"
                            class="text-xs text-yellow-600 hover:text-yellow-800 ml-auto">
                        Restart
                    </button>
                </div>
            </div>
            {% else %}
            <div class="col-span-full text-center py-12 bg-white rounded-lg shadow">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                </svg>
                <h3 class="mt-2 text-sm font-semibold text-gray-900">No deployments</h3>
                <p class="mt-1 text-sm text-gray-500">Deploy your first project to see health metrics.</p>
                <div class="mt-6">
                    <a href="/projects/new" class="inline-flex items-center rounded-md bg-forge-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-forge-500">
                        Create Project
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Metrics Chart Placeholder -->
        <div class="mt-8 bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Response Time (Last 24h)</h3>
            <div class="h-64 bg-gray-50 rounded flex items-center justify-center">
                <p class="text-gray-400">Chart visualization would go here</p>
            </div>
        </div>

        <!-- Recent Incidents -->
        <div class="mt-8 bg-white rounded-lg shadow overflow-hidden">
            <div class="px-4 py-5 sm:px-6">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Recent Incidents</h3>
            </div>
            <ul role="list" class="divide-y divide-gray-200">
                {% for incident in incidents %}
                <li class="px-4 py-4 sm:px-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium {% if incident.severity == 'critical' %}bg-red-100 text-red-800{% elif incident.severity == 'warning' %}bg-yellow-100 text-yellow-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                                {{ incident.severity }}
                            </span>
                            <span class="ml-3 text-sm text-gray-900">{{ incident.message }}</span>
                        </div>
                        <span class="text-sm text-gray-500">{{ incident.timestamp }}</span>
                    </div>
                </li>
                {% else %}
                <li class="px-4 py-8 sm:px-6 text-center text-gray-500">
                    No recent incidents. All systems operational! ðŸŽ‰
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
