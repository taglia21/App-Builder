{% extends "base.html" %}
{% block title %}Agent Workspace - LaunchForge{% endblock %}
{% block content %}
<style>
    .workspace-container { display: grid; grid-template-columns: 280px 1fr 300px; gap: 20px; height: calc(100vh - 140px); }
    .files-panel { background: var(--nexus-card); border: 1px solid var(--nexus-border); border-radius: 12px; padding: 16px; overflow-y: auto; }
    .files-panel h3 { font-size: 0.9rem; color: var(--nexus-text); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .file-tree { list-style: none; padding: 0; }
    .file-tree li { padding: 8px 12px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
    .file-tree li:hover { background: rgba(139, 92, 246, 0.1); }
    .file-tree li.active { background: rgba(139, 92, 246, 0.2); }
    .editor-panel { display: flex; flex-direction: column; }
    .editor-header { background: var(--nexus-card); border: 1px solid var(--nexus-border); border-radius: 12px 12px 0 0; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; }
    .editor-tabs { display: flex; gap: 8px; }
    .editor-tab { padding: 6px 12px; background: var(--nexus-dark); border-radius: 6px; font-size: 0.85rem; cursor: pointer; }
    .editor-tab.active { background: var(--nexus-purple); }
    .code-editor { flex: 1; background: #1a1a1c; border: 1px solid var(--nexus-border); border-top: none; border-radius: 0 0 12px 12px; padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; line-height: 1.6; overflow: auto; white-space: pre-wrap; color: #e0e0e0; }
    .chat-panel { background: var(--nexus-card); border: 1px solid var(--nexus-border); border-radius: 12px; display: flex; flex-direction: column; }
    .chat-header { padding: 16px; border-bottom: 1px solid var(--nexus-border); }
    .chat-header h3 { font-size: 1rem; margin-bottom: 4px; }
    .chat-header p { font-size: 0.85rem; color: var(--nexus-text); }
    .chat-messages { flex: 1; padding: 16px; overflow-y: auto; }
    .chat-message { margin-bottom: 16px; }
    .chat-message.agent { background: rgba(139, 92, 246, 0.1); border-radius: 12px; padding: 12px; }
    .chat-message.user { background: var(--nexus-dark); border-radius: 12px; padding: 12px; }
    .chat-message .sender { font-size: 0.8rem; color: var(--nexus-purple); margin-bottom: 4px; font-weight: 500; }
    .chat-message .text { font-size: 0.9rem; line-height: 1.5; }
    .chat-input { padding: 16px; border-top: 1px solid var(--nexus-border); }
    .chat-input textarea { width: 100%; padding: 12px; background: var(--nexus-dark); border: 1px solid var(--nexus-border); border-radius: 8px; color: white; font-size: 0.9rem; resize: none; }
    .chat-input button { width: 100%; margin-top: 8px; padding: 10px; background: var(--nexus-purple); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; }
    .quick-actions { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; }
    .quick-action { padding: 4px 10px; background: var(--nexus-dark); border: 1px solid var(--nexus-border); border-radius: 20px; font-size: 0.75rem; cursor: pointer; }
    .quick-action:hover { border-color: var(--nexus-purple); }
</style>

<div class="workspace-container">
    <!-- Files Panel -->
    <div class="files-panel">
        <h3>üìÅ Project Files</h3>
        <ul class="file-tree" id="fileTree">
            {% for file in project.files %}
            <li data-file="{{ file.name }}" {% if loop.first %}class="active"{% endif %}>
                {% if file.type == 'python' %}üêç{% elif file.type == 'html' %}üåê{% elif file.type == 'css' %}üé®{% else %}üìÑ{% endif %}
                {{ file.name }}
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Code Editor Panel -->
    <div class="editor-panel">
        <div class="editor-header">
            <div class="editor-tabs">
                <span class="editor-tab active" id="currentFile">app.py</span>
            </div>
            <div>
                <button style="padding: 6px 12px; background: var(--nexus-purple); color: white; border: none; border-radius: 6px; font-size: 0.85rem; cursor: pointer;">üíæ Save</button>
            </div>
        </div>
        <div class="code-editor" id="codeEditor">
<span style="color: #c678dd;">from</span> <span style="color: #e5c07b;">fastapi</span> <span style="color: #c678dd;">import</span> FastAPI, Request
<span style="color: #c678dd;">from</span> <span style="color: #e5c07b;">fastapi.responses</span> <span style="color: #c678dd;">import</span> HTMLResponse
<span style="color: #c678dd;">from</span> <span style="color: #e5c07b;">fastapi.templating</span> <span style="color: #c678dd;">import</span> Jinja2Templates

app = FastAPI(
    title=<span style="color: #98c379;">"{{ project.idea[:30] }}..."</span>,
    description=<span style="color: #98c379;">"AI-powered application"</span>,
    version=<span style="color: #98c379;">"1.0.0"</span>
)

templates = Jinja2Templates(directory=<span style="color: #98c379;">"templates"</span>)

<span style="color: #c678dd;">@app.get</span>(<span style="color: #98c379;">"/"</span>)
<span style="color: #c678dd;">async def</span> <span style="color: #61afef;">home</span>(request: Request):
    <span style="color: #5c6370;">"""Home page."""</span>
    <span style="color: #c678dd;">return</span> templates.TemplateResponse(
        <span style="color: #98c379;">"index.html"</span>,
        {<span style="color: #98c379;">"request"</span>: request}
    )

<span style="color: #c678dd;">@app.get</span>(<span style="color: #98c379;">"/api/health"</span>)
<span style="color: #c678dd;">async def</span> <span style="color: #61afef;">health</span>():
    <span style="color: #c678dd;">return</span> {<span style="color: #98c379;">"status"</span>: <span style="color: #98c379;">"healthy"</span>}
        </div>
    </div>

    <!-- Chat Panel -->
    <div class="chat-panel">
        <div class="chat-header">
            <h3>ü§ñ AI Assistant</h3>
            <p>Ask me to modify your code</p>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message agent">
                <div class="sender">Agent</div>
                <div class="text">Hi! I'm your AI coding assistant. I can help you customize your app. What would you like to change?</div>
            </div>
        </div>
        <div class="chat-input">
            <textarea id="chatInput" rows="3" placeholder="Ask me to modify your code..."></textarea>
            <button onclick="sendMessage()">Send Message</button>
            <div class="quick-actions">
                <span class="quick-action" onclick="quickAction('Add authentication')">Add auth</span>
                <span class="quick-action" onclick="quickAction('Add database')">Add database</span>
                <span class="quick-action" onclick="quickAction('Add API endpoint')">Add API</span>
                <span class="quick-action" onclick="quickAction('Style the UI')">Style UI</span>
            </div>
        </div>
    </div>
</div>

<script>
function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message) return;
    
    // Add user message
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML += `
        <div class="chat-message user">
            <div class="sender">You</div>
            <div class="text">${message}</div>
        </div>
    `;
    input.value = '';
    
    // Simulate agent response
    setTimeout(() => {
        chatMessages.innerHTML += `
            <div class="chat-message agent">
                <div class="sender">Agent</div>
                <div class="text">I understand you want to: "${message}". Let me modify the code for you...</div>
            </div>
        `;
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1000);
    
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function quickAction(action) {
    document.getElementById('chatInput').value = action;
    sendMessage();
}

// File tree click handler
document.querySelectorAll('.file-tree li').forEach(item => {
    item.addEventListener('click', function() {
        document.querySelectorAll('.file-tree li').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('currentFile').textContent = this.dataset.file;
    });
});
</script>
{% endblock %}
